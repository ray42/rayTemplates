%%%% Preamble common to Memoir only

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage{mathpazo} % idk why I even needed this.
%\usepackage{epigraph} % already loaded by memoir class.
\setlength{\epigraphwidth}{.75\linewidth}

%---------------------------------------------------------------------------
% Page layout
%---------------------------------------------------------------------------
\settrimmedsize{297mm}{210mm}{*}
\setlength{\trimtop}{0pt}
\setlength{\trimedge}{\stockwidth}
\addtolength{\trimedge}{-\paperwidth}
\settypeblocksize{634pt}{448.13pt}{*}
\setulmargins{4cm}{*}{*}
\setlrmargins{*}{*}{1.5}
\setmarginnotes{17pt}{51pt}{\onelineskip}
\setheadfoot{\onelineskip}{2\onelineskip}
\setheaderspaces{*}{2\onelineskip}{*}
\checkandfixthelayout

%\setlrmarginsandblock{0.15\paperwidth}{*}{1} % Left and right margin
%\setulmarginsandblock{0.2\paperwidth}{*}{1}  % Upper and lower margin
%\checkandfixthelayout

%%% SECTIONAL DIVISIONS
%%%-------------------------------------------------------------------------

\maxsecnumdepth{subsubsection} % Subsubsections (and higher) are numbered
\setsecnumdepth{subsubsection}

\makeatletter %
\makechapterstyle{standard}{
  \setlength{\beforechapskip}{0\baselineskip}
  \setlength{\midchapskip}{1\baselineskip}
  \setlength{\afterchapskip}{8\baselineskip}
  \renewcommand{\chapterheadstart}{\vspace*{\beforechapskip}}
  \renewcommand{\chapnamefont}{\centering\normalfont\Large}
  \renewcommand{\printchaptername}{\chapnamefont \@chapapp}
  \renewcommand{\chapternamenum}{\space}
  \renewcommand{\chapnumfont}{\normalfont\Large}
  \renewcommand{\printchapternum}{\chapnumfont \thechapter}
  \renewcommand{\afterchapternum}{\par\nobreak\vskip \midchapskip}
  \renewcommand{\printchapternonum}{\vspace*{\midchapskip}\vspace*{5mm}}
  \renewcommand{\chaptitlefont}{\centering\bfseries\LARGE}
  \renewcommand{\printchaptertitle}[1]{\chaptitlefont ##1}
  \renewcommand{\afterchaptertitle}{\par\nobreak\vskip \afterchapskip}
}
\makeatother

\chapterstyle{standard}

\setsecheadstyle{\normalfont\large\bfseries}
\setsubsecheadstyle{\normalfont\normalsize\bfseries}
\setparaheadstyle{\normalfont\normalsize\bfseries}
\setparaindent{0pt}\setafterparaskip{0pt}

%%% FLOATS AND CAPTIONS
%%%-------------------------------------------------------------------------

% Used for figure environment, can now use [H] to put the
% figure right here and force text to go below it.
\usepackage{float}

\makeatletter                  % You do not need to write [htpb] all the time
\renewcommand\fps@figure{htbp} %
\renewcommand\fps@table{htbp}  %
\makeatother                   %

\captiondelim{\space } % A space between caption name and text
\captionnamefont{\small\bfseries} % Font of the caption name
\captiontitlefont{\small\it} % Font of the caption text

\changecaptionwidth          % Change the width of the caption
\captionwidth{1\textwidth} %



%\usepackage[textfont={small,it}, labelfont={small,bf}]{caption}
\usepackage[textfont={small}, labelfont={small,bf}]{caption}
\usepackage[font={small,it},labelformat=simple]{subcaption}
\renewcommand\thesubfigure{(\alph{subfigure})}

%\usepackage{tabularx}

%%% ABSTRACT
%%%-------------------------------------------------------------------------
% Font of abstract title
\renewcommand{\abstractnamefont}{\normalfont\small\bfseries} 
% Width of abstract
\setlength{\absleftindent}{0.1\textwidth} 
\setlength{\absrightindent}{\absleftindent}

%%% HEADER AND FOOTER 
%%%-------------------------------------------------------------------------

\makepagestyle{standard} % Make standard pagestyle

\makeatletter                 % Define standard pagestyle
\makeevenfoot{standard}{}{}{} %
\makeoddfoot{standard}{}{}{}  %
\makeevenhead{standard}{\bfseries\thepage\normalfont\qquad\small\leftmark}{}{}
\makeoddhead{standard}{}{}{\small\rightmark\qquad\bfseries\thepage}
% \makeheadrule{standard}{\textwidth}{\normalrulethickness}
\makeatother                  %

\makeatletter
\makepsmarks{standard}{
\createmark{chapter}{both}{shownumber}{\@chapapp\ }{ \quad }
\createmark{section}{right}{shownumber}{}{ \quad }
\createplainmark{toc}{both}{\contentsname}
\createplainmark{lof}{both}{\listfigurename}
\createplainmark{lot}{both}{\listtablename}
\createplainmark{bib}{both}{\bibname}
\createplainmark{index}{both}{\indexname}
\createplainmark{glossary}{both}{\glossaryname}
}
\makeatother                               %

\makepagestyle{chap} % Make new chapter pagestyle

\makeatletter
\makeevenfoot{chap}{}{\small\bfseries\thepage}{} % Define new chapter pagestyle
\makeoddfoot{chap}{}{\small\bfseries\thepage}{}  %
\makeevenhead{chap}{}{}{}   %
\makeoddhead{chap}{}{}{}    %
% \makeheadrule{chap}{\textwidth}{\normalrulethickness}
\makeatother

\nouppercaseheads
\pagestyle{standard}           % Choosing pagestyle and chapter pagestyle
\aliaspagestyle{chapter}{chap} %


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% https://tex.stackexchange.com/questions/234729/overfull-boxes-in-memoir-table-of-contents
% This is to fix the column width of the contents page, since if the numbers
% are too long, e.g. 11.20.21 (for the subsection), it causes an overflow
% with the text. Change the cft-bit as you see fit.
\setpnumwidth{3em}
\setrmarg{4em}
%\setlength{\cftpartnumwidth}{3em}
\setlength{\cftsectionnumwidth}{3em} % change here.
\setlength{\cftsubsectionnumwidth}{4em} % change here.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% TABLE OF CONTENTS
%%%-------------------------------------------------------------------------
% Only parts, chapters and sections in the table of contents
\maxtocdepth{subsection} 
\settocdepth{subsection}
% Add a \par to the end of the TOC
\AtEndDocument{\addtocontents{toc}{\par}} 


